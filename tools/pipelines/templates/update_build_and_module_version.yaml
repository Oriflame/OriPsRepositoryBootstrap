# Update Build and Module Version
steps:
- task: PowerShell@2
  name: update_build_and_module_version
  displayName: Update Build and Module Version
  inputs:
    targetType: 'inline'
    script: |
      [bool]$isPrerelease = '$(GitVersion.PreReleaseLabel)' -ne '';
      $version = '$(GitVersion.Major).$(GitVersion.Minor).$(GitVersion.CommitsSinceVersionSource)'
      if ($isPrerelease)
      {
          $buildversion = "$version-$(GitVersion.PreReleaseLabel)$(Build.BuildId)"
      }else
      {
          $buildversion = $version
      }
      Write-Output "##vso[build.updatebuildnumber]$buildversion"
      $psManifest = Get-ChildItem -Path "$(System.DefaultWorkingDirectory)/src" -Filter *.psd1 | Select-Object -ExpandProperty FullName -First 1
      Update-ModuleManifest -Path $psManifest -ModuleVersion $version -Prerelease '$(GitVersion.PreReleaseLabel)'
    pwsh: true
    workingDirectory: '$(System.DefaultWorkingDirectory)'
